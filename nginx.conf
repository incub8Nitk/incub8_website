user  nginx;
worker_processes  auto;

events {
	worker_connections  1024;
}

http {
	include       /etc/nginx/mime.types;
	default_type  application/octet-stream;

	sendfile        on;
	keepalive_timeout  65;
	gzip on;
	gzip_comp_level 6;
	gzip_min_length 1024;
	gzip_proxied any;
	gzip_types text/plain text/css application/json application/javascript application/xml application/rss+xml text/javascript image/svg+xml;

	server {
		listen       80;
		server_name  incub8.nitk.ac.in;

		root   /usr/share/nginx/html;
		index  index.html;

		# Cache static assets aggressively
		location ~* \.(?:js|css|svg|ttf|woff|woff2)$ {
			add_header Cache-Control "public, max-age=31536000, immutable";
			try_files $uri =404;
		}

		# Cache images moderately
		location ~* \.(?:png|jpg|jpeg|gif|webp|ico)$ {
			add_header Cache-Control "public, max-age=2592000";
			try_files $uri =404;
		}

		# Serve videos with range requests for faster start/seek
		location ~* \.(?:mp4|webm|ogg)$ {
			add_header Cache-Control "public, max-age=2592000";
			mp4;
			limit_rate_after 2m; # smooth start then limit if needed
			try_files $uri =404;
		}

		# SPA fallback
		location / {
			try_files $uri $uri/ /index.html;
		}
	}
}


